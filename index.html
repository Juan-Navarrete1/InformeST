<!DOCTYPE html>
<html lang="es">
<head>
    
    <link rel="stylesheet" href="estilos.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
    
    <!-- Estilos -->
    
</head>
<body>
    <!-- ... otros elementos ... -->
    <canvas id="donutChart" width="400" height="400" style="display: none;"></canvas>
    <!-- ... otros elementos ... -->
</body>

<body>

    <div class="container">
        <form id="formularioServicio" action="procesar_formulario.php" method="post" enctype="multipart/form-data">
            <!-- Campos del formulario -->
            <h1>Formulario de Servicio</h1>
            <label for="planta">Planta:</label>
            <select id="planta" name="planta" required>
                <option value="">Seleccione una opción</option>
                <option value="Sopraval">Sopraval</option>
                <option value="Lo miranda cerdo">Lo miranda cerdo</option>
                <option value="Lo miranda aves">Lo miranda aves</option>
                <option value="San vicente">Sanvicente</option>
                <option value="Walmart">Walmart</option>
                <option value="Chile Beef">Chile Beef</option>
                <option value="Castaño">Castaño</option>
                 <option value="Don pollo">Don pollo</option>
            </select>
            <label for="tipo_servicio">Tipo de Servicio:</label>
            <select id="tipo_servicio" name="tipo_servicio" required>
                <option value="">Seleccione una opción</option>
                <option value="Plan de continuidad">Mantenimiento</option>
                <option value="Emergencia">Reparación</option>
                <option value="Mantencion">Instalación</option>
                <option value="Asistencia programada">Asistencia programada</option>
            </select>

            <label for="fecha">Fecha:</label>
            <input type="date" id="fecha" name="fecha" required>

            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" rows="4" required></textarea>

            <label for="modelo">Modelo:</label>
            <select id="modelo" name="modelo" required>
                <option value="">Seleccione una opción</option>
                <option value="GTR">GTR</option>
                <option value="GTRe">GTRe</option>
                <option value="GT0">GT0</option>
                <option value="GT0s">GT0s</option>
                <option value="GT1">GT1</option>
                <option value="GT1s">GT1s</option>
                <option value="GT1e">GT1e</option>
                <option value="GT2">GT2</option>
                <option value="GT2 TWIN">GT2 TWIN</option>
                <option value="GT5 TWIN">GT5 TWIN</option>
               
            </select>

            <label for="numero_serie">N.º de Serie:</label>
            <input type="text" id="numero_serie" name="numero_serie" required>
            
            <label for="Maquina">Maquina:</label>
            <select id="Maquina" name="Maquina" required>
                <option value="">Seleccione una opción</option>
                <option value="Termoselladora">Termoselladora</option>
            </select>

            <label for="Marca">Marca:</label>
            <select id="Marca" name="Marca" required>
                <option value="">Seleccione una opción</option>
            <option value="Proseal">Proseal</option>
            </select>

            <label for="Año">Año:</label>
            <input type="text" id="Año" name="Año" required>


    <div class="image-upload">
        <div>
            <label for="imagen5">Maquina a inspeccionar</label>
            <input type="file" id="imagen5" name="imagen5" accept="image/*" onchange="previewImage(event, 'preview5')">
            <img id="preview5" alt="Previsualización de la imagen">
        </div>
    </div>

            <!-- Tabla de Revisión Estructural -->
            <h2>Revisión Estructural</h2>
            <table>
                <thead>
                    <tr>
                        <th>Limpieza</th>
                        <th>Estado de cintas</th>
                        <th>Tableros de control</th>
                        <th>Motores</th>
                        <th>Sistema neumático</th>
                        <th>Estado matriz</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox" name="limpieza"></td>
                        <td><input type="checkbox" name="estado_cintas"></td>
                        <td><input type="checkbox" name="tableros_control"></td>
                        <td><input type="checkbox" name="motores"></td>
                        <td><input type="checkbox" name="sistema_neumatico"></td>
                        <td><input type="checkbox" name="estado_matriz"></td>
                    </tr>
                </tbody>
            </table>

            <!-- Tabla de Revisión de Puertas -->
            <h2>Revisión de Puertas</h2>
            <table>
                <thead>
                    <tr>
                        <th>Zona de puerta</th>
                        <th>Estado</th>
                        <th>Estatus</th>
                        <th>Observación</th>
                        <th>Recomendación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Puerta frontal</td>
                        <td><input type="checkbox" name="estado_puerta_1"></td>
                        <td>
                            <select name="estatus_puerta_1">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_1"></td>
                        <td><input type="text" name="recomendacion_puerta_1"></td>
                    </tr>
                    <tr>
                        <td>Puerta trasera</td>
                        <td><input type="checkbox" name="estado_puerta_2"></td>
                        <td>
                            <select name="estatus_puerta_2">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_2"></td>
                        <td><input type="text" name="recomendacion_puerta_2"></td>
                    </tr>
                    <tr>
                        <td>Puerta salida superior</td>
                        <td><input type="checkbox" name="estado_puerta_3"></td>
                        <td>
                            <select name="estatus_puerta_3">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_3"></td>
                        <td><input type="text" name="recomendacion_puerta_3"></td>
                    </tr>
                    <tr>
                        <td>Puerta entrada superior</td>
                        <td><input type="checkbox" name="estado_puerta_4"></td>
                        <td>
                            <select name="estatus_puerta_4">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_4"></td>
                        <td><input type="text" name="recomendacion_puerta_4"></td>
                    </tr>
                    <tr>
                        <td>Puerta entrada inferior</td>
                        <td><input type="checkbox" name="estado_puerta_5"></td>
                        <td>
                            <select name="estatus_puerta_5">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_5"></td>
                        <td><input type="text" name="recomendacion_puerta_5"></td>
                    </tr>
                    <tr>
                        <td>Puerta frontal inferior</td>
                        <td><input type="checkbox" name="estado_puerta_6"></td>
                        <td>
                            <select name="estatus_puerta_6">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_6"></td>
                        <td><input type="text" name="recomendacion_puerta_6"></td>
                    </tr>
                    <tr>
                        <td>Puerta trasera inferior</td>
                        <td><input type="checkbox" name="estado_puerta_7"></td>
                        <td>
                            <select name="estatus_puerta_7">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_7"></td>
                        <td><input type="text" name="recomendacion_puerta_7"></td>
                    </tr>
                    <tr>
                        <td>Puerta salida delantera inferior</td>
                        <td><input type="checkbox" name="estado_puerta_8"></td>
                        <td>
                            <select name="estatus_puerta_8">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_8"></td>
                        <td><input type="text" name="recomendacion_puerta_8"></td>
                    </tr>
                    <tr>
                        <td>Puerta salida trasera inferior</td>
                        <td><input type="checkbox" name="estado_puerta_9"></td>
                        <td>
                            <select name="estatus_puerta_9">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_9"></td>
                        <td><input type="text" name="recomendacion_puerta_9"></td>
                    </tr>
                    <tr>
                        <td>Puerta entrada superior 2</td>
                        <td><input type="checkbox" name="estado_puerta_10"></td>
                        <td>
                            <select name="estatus_puerta_10">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_10"></td>
                        <td><input type="text" name="recomendacion_puerta_10"></td>
                    </tr>
                    <tr>
                        <td>Puerta entrada trasera inferior</td>
                        <td><input type="checkbox" name="estado_puerta_11"></td>
                        <td>
                            <select name="estatus_puerta_11">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_puerta_11"></td>
                        <td><input type="text" name="recomendacion_puerta_11"></td>
                    </tr>
                </tbody>
            </table>

            <!-- Tabla Safety Relay y Parada de Emergencia -->
            <h2>Safety Relay y Parada de Emergencia</h2>
            <table>
                <thead>
                    <tr>
                        <th>Elemento</th>
                        <th>Estado</th>
                        <th>Observación</th>
                        <th>Recomendación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Safety Relay</td>
                        <td>
                            <select name="estado_safety_relay">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_safety_relay"></td>
                        <td><input type="text" name="recomendacion_safety_relay"></td>
                    </tr>
                    <tr>
                        <td>Parada de Emergencia</td>
                        <td>
                            <select name="estado_parada_emergencia">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_parada_emergencia"></td>
                        <td><input type="text" name="recomendacion_parada_emergencia"></td>
                    </tr>
                    <tr>
                        <td>Interruptor Principal</td>
                        <td>
                            <select name="estado_interruptor_principal">
                                <option value="operativo">Operativo</option>
                                <option value="no_operativo">No operativo</option>
                            </select>
                        </td>
                        <td><input type="text" name="observacion_interruptor_principal"></td>
                        <td><input type="text" name="recomendacion_interruptor_principal"></td>
                    </tr>
                </tbody>
            </table>

            <!-- Recuadros para insertar imágenes -->
            <h2>Registro Fotográfico</h2>
            <div class="image-upload">
                <div>
                    <label for="imagen1">Imagen 1</label>
                    <input type="file" id="imagen1" name="imagen1" accept="image/*" onchange="previewImage(event, 'preview1')">
                    <img id="preview1" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen2">Imagen 2</label>
                    <input type="file" id="imagen2" name="imagen2" accept="image/*" onchange="previewImage(event, 'preview2')">
                    <img id="preview2" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen3">Imagen 3</label>
                    <input type="file" id="imagen3" name="imagen3" accept="image/*" onchange="previewImage(event, 'preview3')">
                    <img id="preview3" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen4">Imagen 4</label>
                    <input type="file" id="imagen4" name="imagen4" accept="image/*" onchange="previewImage(event, 'preview4')">
                    <img id="preview4" alt="Previsualización de la imagen">
                </div>
            </div>

            <label for="observacion_fotografico">Observación:</label>
            <textarea id="observacion_fotografico" name="observacion_fotografico" rows="5"></textarea>

            <!-- Tabla Fotografía Termográficas -->
            <h2>Fotografías Termográficas</h2>
            <table>
                <thead>
                    <tr>
                        <th>Componentes Analizados</th>
                        <th>Temperatura °C</th>
                        <th>Rango de Trabajo Máximo °C</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Contactor</td>
                        <td><input type="number" name="temperatura_contactor" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>Relé de estado sólido</td>
                        <td><input type="number" name="temperatura_rele_estado_solido" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>Servo amplificador</td>
                        <td><input type="number" name="temperatura_servo_amplificador" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>Safety Relay</td>
                        <td><input type="number" name="temperatura_safety_relay_comp" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>VDF</td>
                        <td><input type="number" name="temperatura_vdf" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>PLC</td>
                        <td><input type="number" name="temperatura_plc" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>Relé 24 VDC</td>
                        <td><input type="number" name="temperatura_rele_24vdc" required></td>
                        <td>75°C</td>
                    </tr>
                    <tr>
                        <td>Power Supply</td>
                        <td><input type="number" name="temperatura_power_supply" required></td>
                        <td>75°C</td>
                    </tr>
                </tbody>
            </table>

            <!-- Recuadros para insertar imágenes de componentes -->
            <h2>Registro Fotográfico de Componentes</h2>
            <div class="image-upload">
                <div>
                    <label for="imagen_contactor">Contactor</label>
                    <input type="file" id="imagen_contactor" name="imagen_contactor" accept="image/*" onchange="previewImage(event, 'preview_contactor')">
                    <img id="preview_contactor" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_rele_estado_solido">Relé de Estado Sólido</label>
                    <input type="file" id="imagen_rele_estado_solido" name="imagen_rele_estado_solido" accept="image/*" onchange="previewImage(event, 'preview_rele_estado_solido')">
                    <img id="preview_rele_estado_solido" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_servo_amplificador">Servo Amplificador</label>
                    <input type="file" id="imagen_servo_amplificador" name="imagen_servo_amplificador" accept="image/*" onchange="previewImage(event, 'preview_servo_amplificador')">
                    <img id="preview_servo_amplificador" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_safety_relay_comp">Safety Relay</label>
                    <input type="file" id="imagen_safety_relay_comp" name="imagen_safety_relay_comp" accept="image/*" onchange="previewImage(event, 'preview_safety_relay_comp')">
                    <img id="preview_safety_relay_comp" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_vdf">VDF</label>
                    <input type="file" id="imagen_vdf" name="imagen_vdf" accept="image/*" onchange="previewImage(event, 'preview_vdf')">
                    <img id="preview_vdf" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_plc">PLC</label>
                    <input type="file" id="imagen_plc" name="imagen_plc" accept="image/*" onchange="previewImage(event, 'preview_plc')">
                    <img id="preview_plc" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_rele_24vdc">Relé 24 VDC</label>
                    <input type="file" id="imagen_rele_24vdc" name="imagen_rele_24vdc" accept="image/*" onchange="previewImage(event, 'preview_rele_24vdc')">
                    <img id="preview_rele_24vdc" alt="Previsualización de la imagen">
                </div>
                <div>
                    <label for="imagen_power_supply">Power Supply</label>
                    <input type="file" id="imagen_power_supply" name="imagen_power_supply" accept="image/*" onchange="previewImage(event, 'preview_power_supply')">
                    <img id="preview_power_supply" alt="Previsualización de la imagen">
                </div>
            </div>

            <label for="observacion_componentes">Observación:</label>
            <textarea id="observacion_componentes" name="observacion_componentes" rows="5"></textarea>

            <!-- Tabla Reporte Diagnóstico -->
            <h2>Reporte Diagnóstico</h2>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Detalle Diagnóstico</th>
                        <th>Acción Correctiva</th>
                        <th>Observación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Actuador de sello</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Cintas de entrada</td>
                        <td>
                            <select name="detalle_diagnostico_cintas_entrada">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_cintas_entrada">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_cintas_entrada">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Cintas de salida</td>
                        <td>
                            <select name="detalle_diagnostico_cintas_salida">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_cintas_salida">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_cintas_salida">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Tablero</td>
                        <td>
                            <select name="detalle_diagnostico_tablero">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_tablero">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_tablero">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Matriz</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Pantalla HMI</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Rebobinador de film</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin detalle">Sin detalle</option>
                                <option value="con detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Alimentacion de film</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Estacion de sello</td>
                        <td>
                            <select name="detalle_diagnostico_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="accion_correctiva_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                        <td>
                            <select name="observacion_actuador">
                                <option value="sin_detalle">Sin detalle</option>
                                <option value="con_detalle">Con detalle</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Observación Final -->
            <h2>Observación Final</h2>
            <label for="observacion_final">Observación:</label>
            <textarea id="observacion_final" name="observacion_final" rows="5"></textarea>

            <!-- Botón para generar PDF -->
            <button type="button" id="generarPDF">Generar PDF</button>
        </form>
    </div>

     <!-- Canvas para el gráfico donut (oculto) -->
     <canvas id="donutChart" width="400" height="400" style="display: none;"></canvas>

    <!-- JavaScript para previsualizar imágenes -->
    <script>
        function previewImage(event, previewId) {
            var reader = new FileReader();
            reader.onload = function() {
                var output = document.getElementById(previewId);
                output.src = reader.result;
                output.style.display = 'block';  // Mostrar la imagen al cargarla
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>

    <!-- jsPDF y jspdf-autotable para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <!-- Script para generar el gráfico donut y el PDF -->
    <script>
        // Función para generar el gráfico donut
        function generateDonutChart() {
    return new Promise((resolve, reject) => {
        const canvas = document.getElementById('donutChart');
        const ctx = canvas.getContext('2d');

                // Calcular los datos basados en los inputs del formulario
                const totalItems = 6; // Número total de elementos en Revisión Estructural
                let completedItems = 0;

                if (document.querySelector('input[name="limpieza"]').checked) completedItems++;
                if (document.querySelector('input[name="estado_cintas"]').checked) completedItems++;
                if (document.querySelector('input[name="tableros_control"]').checked) completedItems++;
                if (document.querySelector('input[name="motores"]').checked) completedItems++;
                if (document.querySelector('input[name="sistema_neumatico"]').checked) completedItems++;
                if (document.querySelector('input[name="estado_matriz"]').checked) completedItems++;

                const pendingItems = totalItems - completedItems;

                const data = {
                    labels: ['Completado', 'Pendiente'],
                    datasets: [{
                        data: [completedItems, pendingItems],
                        backgroundColor: ['green', 'red'],
                        hoverBackgroundColor: ['darkgreen', 'darkred']
                    }]
                };

                const options = {
    responsive: false,
    animation: false,
    plugins: {
        legend: {
            position: 'bottom',
        }
    }
};


                // Destruir cualquier instancia previa del gráfico
                if (window.donutChartInstance) {
            window.donutChartInstance.destroy();
        }

        window.donutChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: options
        });

        // Esperar un pequeño intervalo para asegurarse de que el gráfico se ha renderizado
        setTimeout(() => {
            // Ocultar el canvas nuevamente
            canvas.style.visibility = 'hidden';
            resolve();
        }, 10);
    });
}
        </script>
            
   <script>
        document.getElementById("generarPDF").addEventListener("click", function() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');

                // Generar el gráfico antes de generar el PDF
    generateDonutChart().then(() => {
        // Una vez que el gráfico está listo, proceder a generar el PDF
       
    });

            function agregarObservacion(pdf, textoObservacion, x, y, ancho, colorBorde = [0, 0, 0], colorFondo = null) {
    // Ajustar el texto al ancho del recuadro
    const observacionText = pdf.splitTextToSize(textoObservacion, ancho - 5); 

    // Calcular la altura del recuadro según la cantidad de líneas de texto
    const alto = observacionText.length * 7 + 10;  // Ajusta esta fórmula si necesitas más o menos espacio vertical
    
    // Establecer el color del borde
    pdf.setDrawColor(57, 255, 20);  // Cambiar el color del borde (RGB)
    
    if (colorFondo) {
        // Si se pasa un color de fondo, usar setFillColor y dibujar el rectángulo con relleno
        pdf.setFillColor(...colorFondo);  // Cambiar el color de fondo (RGB)
        pdf.rect(x, y, ancho, alto, 'FD');  // 'FD' dibuja el rectángulo con borde y relleno
    } else {
        pdf.rect(x, y, ancho, alto);  // Dibujar solo el borde si no se pasa un color de fondo
    }

    // Agregar el texto de observación dentro del recuadro
    pdf.text(observacionText, x + 2, y + 5);  // Texto con margen dentro del recuadro

    return alto;  // Devolver la altura del recuadro para ajustar el yOffset
}


            // Inicializar número de página
            let pageNumber = 1;

            // Constantes para márgenes
            const marginLeft = 15;
            const marginRight = 15;
            const contentWidth = pdf.internal.pageSize.getWidth() - marginLeft - marginRight;

            // Función para agregar encabezado con imagen base64
function addHeader(pdf) {
    const base64Img = 'encabezado.jpg';  // Reemplaza esto con tu imagen en base64
    
    const pageWidth = pdf.internal.pageSize.getWidth();  // Obtener el ancho total de la página
    const marginLeft = 5;  // Mínimo margen izquierdo
    const marginRight = 5;  // Mínimo margen derecho

    const imgWidth = pageWidth - marginLeft - marginRight;  // Ancho total de la imagen
    const imgHeight = imgWidth * (5/ 38);  // Ajusta la proporción de la imagen según sea necesario (3:10 es solo un ejemplo)

    const xPosition = marginLeft;  // Comienza desde el borde izquierdo con el margen mínimo
    const yPosition = 5;  // Posición Y en la parte superior con un margen pequeño

    // Agregar la imagen al PDF 
    pdf.addImage(base64Img, 'PNG', xPosition, yPosition, imgWidth, imgHeight);

}


            // Función para agregar pie de página
            function addFooter(pdf, pageNumber) {
                const pageHeight = pdf.internal.pageSize.getHeight();
                pdf.setDrawColor(0);
                pdf.setDrawColor(0, 255, 0); // Bordes naranjas
                pdf.setLineWidth(0.5);
                pdf.line(marginLeft, pageHeight - 20, pdf.internal.pageSize.getWidth() - marginRight, pageHeight - 20);
                pdf.setFontSize(10);
                pdf.setTextColor(100);
                pdf.text("Página " + pageNumber, pdf.internal.pageSize.getWidth() / 2, pageHeight - 10, { align: 'center' });
            }

            // Función para agregar una nueva página
            function addNewPage(pdf) {
                pdf.addPage();
                pageNumber++;
                addHeader(pdf);
                addFooter(pdf, pageNumber);
                yOffset = 37;
            }

            


            // Inicializar yOffset para la posición del contenido
            let yOffset = 37;
            addHeader(pdf);
            addFooter(pdf, pageNumber);

            function agregarPagina1() {
                
                pdf.setFontSize(16);
pdf.text("Formulario de Servicio", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
yOffset += 10;
pdf.setFontSize(12);

// Datos de la primera línea: Planta, Tipo de Servicio y Fecha
const planta = `Planta: ${document.getElementById("planta").value}`;
const tipoServicio = `Tipo de Servicio: ${document.getElementById("tipo_servicio").value}`;
const fecha = `Fecha: ${document.getElementById("fecha").value}`;

// Encabezado y datos para la tabla
const encabezado = [['Planta', 'Tipo de Servicio', 'Fecha']];
const cuerpo = [[
    document.getElementById("planta").value,
    document.getElementById("tipo_servicio").value,
    document.getElementById("fecha").value
]];

// Configuración de la tabla con encabezado verde
pdf.autoTable({
    startY: yOffset, // Posición vertical de inicio
    head: encabezado, // Encabezado de la tabla
    body: cuerpo, // Cuerpo de la tabla con los datos
    margin: { left: 10, right: 10},
    styles: {
        fontSize: 10, // Tamaño de fuente general
        halign: 'center', // Alineación del texto en el centro
        valign: 'middle', // Alineación vertical al centro
        cellPadding: 1.5, // Espacio dentro de cada celda
    },
    headStyles: {
        fillColor: [0, 155, 0], // Fondo verde para el encabezado
        textColor: [255, 255, 255], // Texto blanco en el encabezado
        halign: 'center', // Alineación horizontal centrada para los encabezados
        fontSize: 12, // Tamaño de fuente para el encabezado
        fontStyle: 'bold' // Negrita para el encabezado
    },
    theme: 'striped' // Tema de la tabla con filas alternadas
});

yOffset += 22; // Espacio después de la tabla

    
  // Segunda línea como tabla con fondo verde
  const modelo = document.getElementById("modelo").value;
    const numeroSerie = document.getElementById("numero_serie").value;
    const maquina = document.getElementById("Maquina").value;
    const marca = document.getElementById("Marca").value;
    const año = document.getElementById("Año").value;

    // Configuración de la tabla con fondo verde
    pdf.autoTable({
        startY: yOffset, // Posición vertical de inicio
        head: [['Modelo', 'N.º de Serie', 'Máquina', 'Marca', 'Año']], // Encabezado
        body: [[modelo, numeroSerie, maquina, marca, año]], // Datos
        margin: { 
        top: 10,      // Margen superior
        bottom: 10,   // Margen inferior
        left: 10,     // Margen izquierdo
        right: 10     // Margen derecho
    },
        styles: {
            fontSize: 10, // Tamaño de fuente general
            halign: 'center', // Alineación del texto en el centro
            valign: 'middle', // Alineación vertical en el medio de la celda
            cellPadding: 1.5, // Reducción del espacio dentro de cada celda para ajustar la separación
        },
        headStyles: {
            fillColor: [0, 155, 0], // Fondo verde para el encabezado
            textColor: [255, 255, 255], // Texto blanco en el encabezado
            halign: 'center', // Alineación horizontal centrada para los encabezados
            fontSize: 12, // Tamaño de fuente para el encabezado
            
            cellPadding: 2, // Reducción del espacio dentro del encabezado
        },
        theme: 'striped', // Tema de la tabla con filas alternadas
        columnStyles: {
            0: { cellWidth: 38 }, // Ancho fijo para la columna 'Modelo'
            1: { cellWidth: 38 }, // Ancho fijo para la columna 'N.º de Serie'
            2: { cellWidth: 38 }, // Ancho fijo para la columna 'Máquina'
            3: { cellWidth: 38 }, // Ancho fijo para la columna 'Marca'
            4: { cellWidth: 38 }, // Ancho fijo para la columna 'Año'
        }
    });

    yOffset = pdf.lastAutoTable.finalY + 10; // Ajustar el yOffset después de la tabla
// Descripción con recuadro
pdf.setFontSize(12);
pdf.text("Descripción:", marginLeft, yOffset);
yOffset += 4; // Espacio entre el título y el recuadro de la descripción

let descripcion = document.getElementById("descripcion").value;

// Configuración de los márgenes izquierdo y derecho
const margenIzquierdo = 10; // Ajusta este valor para definir el margen izquierdo
const margenDerecho = 10; // Ajusta este valor para definir el margen derecho
const recuadroAncho = pdf.internal.pageSize.getWidth() - margenIzquierdo - margenDerecho; // Ancho del recuadro

// Dividir el texto para ajustarlo al ancho disponible
let descripcionText = pdf.splitTextToSize(descripcion, recuadroAncho);

// Dibujar el recuadro para la descripción
const recuadroAlto = descripcionText.length * 7 + 8; // Alto basado en la cantidad de líneas del texto
pdf.setFillColor(240, 240, 240); // Color de relleno verde
pdf.rect(margenIzquierdo, yOffset, recuadroAncho, recuadroAlto, 'F'); // Dibujar rectángulo de fondo

// Texto de la descripción dentro del recuadro
pdf.setTextColor(0, 0, 0); // Texto blanco
pdf.text(descripcionText, margenIzquierdo + 2, yOffset + 6); // Añadir un margen interno para el texto dentro del recuadro

// Ajustar yOffset después de agregar el recuadro
yOffset += recuadroAlto + 15; // Añadir un espacio después del recuadro

pdf.setFontSize(14);
pdf.text(
  "Maquina a inspeccionar",
  pdf.internal.pageSize.getWidth() / 2,
  yOffset,
  { align: "center" }
);
yOffset += 2;

 // Imagen debajo de "Maquina a inspeccionar"
 const imagenElement = document.getElementById("imagen5");

 // Función para agregar la imagen en la página 1
function agregarImagenPagina1(callback) {
    const imagenElement = document.getElementById("imagen5"); // Imagen del campo 'imagen5'

    if (imagenElement.files.length > 0) {
        const file = imagenElement.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.src = event.target.result;
            img.onload = function() {
                // Ajustar tamaño de la imagen y calcular la posición para centrarla
                const imgWidth = img.width;
                const imgHeight = img.height;
                const ratio = Math.min(150 / imgWidth, 105 / imgHeight); // Ajustar proporciones
                const newWidth = imgWidth * ratio;
                const newHeight = imgHeight * ratio;

                // Calcular la posición X para centrar la imagen en la página
                const pageWidth = pdf.internal.pageSize.getWidth();
                const xPosition = (pageWidth - newWidth) / 2; // Centrando la imagen horizontalmente
                const yPosition = 150; // Posición Y fija debajo del texto

                // Insertar la imagen en la posición centrada
                pdf.addImage(img, 'JPEG', xPosition, yPosition, newWidth, newHeight);
                callback();
            };
        };
        reader.readAsDataURL(file);
    } else {
        callback(); // Continuar si no hay imagen seleccionada
    }
}

  // Llamar a la función para agregar la imagen debajo de "Maquina a inspeccionar"
  agregarImagenPagina1(function() {
            // Después de la imagen, continuar con la página 2
            agregarPagina2();
        });
    }

            function agregarPagina2() {
    addNewPage(pdf);
    pdf.setFontSize(14);
                pdf.text("Revisión Estructural", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
                yOffset += 8;

                const revisionHead = [['Limpieza', 'Estado de cintas', 'Tableros de control', 'Motores', 'Sistema neumático', 'Estado matriz']];
                const revisionBody = [
                    [
                        
                        document.querySelector('input[name="limpieza"]').checked ? 'Sí' : 'No',
                        document.querySelector('input[name="estado_cintas"]').checked ? 'Sí' : 'No',
                        document.querySelector('input[name="tableros_control"]').checked ? 'Sí' : 'No',
                        document.querySelector('input[name="motores"]').checked ? 'Sí' : 'No',
                        document.querySelector('input[name="sistema_neumatico"]').checked ? 'Sí' : 'No',
                        document.querySelector('input[name="estado_matriz"]').checked ? 'Sí' : 'No',
                       
                    ]
                ];

                pdf.autoTable({
    head: revisionHead,
    body: revisionBody,
    startY: yOffset, // Posición vertical de inicio
    margin: { 
        top: 10,      // Margen superior
        bottom: 10,   // Margen inferior
        left: 10,     // Margen izquierdo
        right: 10     // Margen derecho
    },
    styles: { 
        fontSize: 10,               // Tamaño de fuente general
        halign: 'center',           // Alineación del texto en el centro
       
    },
    headStyles: { 
        fillColor: [0, 155, 0], // Fondo del encabezado (blanco)
        textColor: [255, 255, 255],       // Texto del encabezado (negro)

    },
   
    theme: 'striped' // Tema de la tabla (con filas alternadas)
});


yOffset = pdf.lastAutoTable.finalY + 10;

                yOffset = pdf.lastAutoTable.finalY + 10;

                pdf.setFontSize(14);
pdf.text("Revisión de Puertas", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
yOffset += 8;

const puertasHead = [['Zona de puerta', 'Estado', 'Estatus', 'Observación', 'Recomendación']];
const puertasBody = [];
const totalPuertas = 11;

for (let i = 1; i <= totalPuertas; i++) {
    puertasBody.push([
        `Puerta ${i}`,
        document.querySelector(`input[name="estado_puerta_${i}"]`).checked ? 'OK' : 'X',
        document.querySelector(`select[name="estatus_puerta_${i}"]`).value,
        document.querySelector(`input[name="observacion_puerta_${i}"]`).value,
        document.querySelector(`input[name="recomendacion_puerta_${i}"]`).value
    ]);
}

// Cambiar los colores de la tabla
pdf.autoTable({
    head: puertasHead,
    body: puertasBody,
    startY: yOffset, // Posición vertical de inicio
    margin: { 
        top: 10,       // Margen superior
        bottom: 10,    // Margen inferior
        left: 10,      // Margen izquierdo
        right: 10      // Margen derecho
    },
    styles: { 
        fontSize: 10,               // Tamaño de fuente general
        halign: 'center',           // Alineación del texto en el centro
        lineColor: [0, 255, 0],     // Color del borde (verde flúor)
        lineWidth: 0.5              // Ancho del borde
    },
    headStyles: { 
        fillColor: [0, 155, 0], // Fondo del encabezado (blanco)
        textColor: [255, 255, 255],       // Texto del encabezado (negro)
       
    },
    bodyStyles: { 
        fillColor: [245, 245, 245], // Fondo del cuerpo (gris claro)
        textColor: [0, 0, 0],       // Texto del cuerpo (negro)
        lineColor: [0, 0, 0],       // Color del borde del cuerpo (negro)
        lineWidth: 0.5              // Ancho del borde del cuerpo
    },
    theme: 'grid' // Estilo de tabla con bordes visibles
});


yOffset = pdf.lastAutoTable.finalY + 10;


pdf.setFontSize(14);
pdf.text("Safety Relay y Parada de Emergencia", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
yOffset += 8;

const safetyHead = [['Elemento', 'Estado', 'Observación', 'Recomendación']];
const safetyBody = [
    [
        'Safety Relay',
        document.querySelector('select[name="estado_safety_relay"]').value,
        document.querySelector('input[name="observacion_safety_relay"]').value,
        document.querySelector('input[name="recomendacion_safety_relay"]').value
    ],
    [
        'Parada de Emergencia',
        document.querySelector('select[name="estado_parada_emergencia"]').value,
        document.querySelector('input[name="observacion_parada_emergencia"]').value,
        document.querySelector('input[name="recomendacion_parada_emergencia"]').value
    ],
    [
        'Interruptor Principal',
        document.querySelector('select[name="estado_interruptor_principal"]').value,
        document.querySelector('input[name="observacion_interruptor_principal"]').value,
        document.querySelector('input[name="recomendacion_interruptor_principal"]').value
    ]
];

// Cambiar los colores de la tabla

pdf.autoTable({
    head: safetyHead,
    body: safetyBody,
    startY: yOffset, // Posición vertical de inicio
    margin: { 
        top: 10,       // Margen superior
        bottom: 10,    // Margen inferior
        left: 10,      // Margen izquierdo
        right: 10      // Margen derecho
    },
    styles: { 
        fontSize: 10,               // Tamaño de fuente general
        halign: 'center',           // Alineación del texto en el centro
        lineColor: [0, 255, 0],     // Color del borde (verde flúor)
        lineWidth: 0.5              // Ancho del borde
    },
    headStyles: { 
        fillColor: [0, 155, 0], // Fondo del encabezado (blanco)
        textColor: [255, 255, 255],       // Texto del encabezado (negro)
       
    },
    bodyStyles: { 
        fillColor: [245, 245, 245], // Fondo del cuerpo (gris claro)
        textColor: [0, 0, 0],       // Texto del cuerpo (negro)
        lineColor: [0, 0, 0],       // Color del borde del cuerpo (negro)
        lineWidth: 0.5              // Ancho del borde del cuerpo
    },
    theme: 'grid' // Estilo de tabla con bordes visibles
});


yOffset = pdf.lastAutoTable.finalY + 10;


                yOffset = pdf.lastAutoTable.finalY + 10;

    agregarPagina3();
}

            function agregarPagina3() {
    // Página 3: Registro Fotográfico y Observación
    addNewPage(pdf); // Iniciar nueva página
    pdf.setFontSize(14);
    pdf.text("Registro Fotográfico", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 10;

    const imagenes = [
        document.getElementById("imagen1"),
        document.getElementById("imagen2"),
        document.getElementById("imagen3"),
        document.getElementById("imagen4")
    ];

    let imagenIndex = 0;

    function agregarImagenesRegistroFotografico() {
    const columnas = 2; // 2 imágenes por fila
    const filas = 2; // 2 filas de imágenes
    const espacio = 10; // Espacio entre las imágenes
    const bordeWidth = (pdf.internal.pageSize.getWidth() - 2 * marginLeft - espacio) / columnas; // Ancho del borde
    const bordeHeight = bordeWidth * 0.75; // Mantener proporción 4:3

    function agregarImagen(imagen, xPosition, yPosition, width, height, callback) {
        const file = imagen.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function () {
                    // Reducir tamaño de la imagen un poco más y centrarla
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    const ratio = Math.min((width * 0.9) / imgWidth, (height * 0.9) / imgHeight); // Reducir tamaño al 90%
                    const newWidth = imgWidth * ratio;
                    const newHeight = imgHeight * ratio;
                    const offsetX = (width - newWidth) / 2;
                    const offsetY = (height - newHeight) / 2;

                    // Insertar imagen
                    pdf.addImage(img, 'JPEG', xPosition + offsetX, yPosition + offsetY, newWidth, newHeight);
                    callback();
                };
            };
            reader.readAsDataURL(file);
        } else {
            callback();
        }
    }

    function agregarImagenes() {
        if (imagenIndex < imagenes.length) {
            let fila = Math.floor(imagenIndex / columnas); // Determinar la fila
            let columna = imagenIndex % columnas; // Determinar la columna

            let xPosition = marginLeft + columna * (bordeWidth + espacio); // Posición horizontal del borde
            let yPosition = yOffset + fila * (bordeHeight + espacio); // Posición vertical del borde

            // Dibujar borde negro continuo alrededor de la imagen
            pdf.setDrawColor(0, 155, 0); // Color negro
            pdf.setLineWidth(1); // Ancho de línea para el borde
            pdf.rect(xPosition, yPosition, bordeWidth, bordeHeight); // Dibujar el borde

            let imagen = imagenes[imagenIndex];

            // Insertar la imagen dentro del cuadro y centrarla
            agregarImagen(imagen, xPosition, yPosition, bordeWidth, bordeHeight, function () {
                imagenIndex++;
                if (imagenIndex % columnas === 0 && fila === filas - 1) {
                    yOffset += bordeHeight + espacio; // Ajustar la posición vertical después de cada fila
                }
                agregarImagenes(); // Llamada recursiva para agregar la siguiente imagen
            });
        } else {
            // Continuar con el resto del PDF cuando se han insertado todas las imágenes
            yOffset += bordeHeight + espacio; // Ajustar después de agregar la última fila de imágenes
            agregarObservacionFotografico(); // Pasar a la siguiente sección
        }
    }

    agregarImagenes(); // Iniciar la inserción de imágenes
}


function agregarObservacionFotografico() {
    pdf.setFontSize(12);
    yOffset += 8; // Reducir el espacio entre imágenes y observación

    pdf.text("Observación:", marginLeft, yOffset);
    yOffset += 5;

    // Obtener el texto de observación del campo correspondiente
    let observacionFotografico = document.getElementById("observacion_fotografico").value;

    // Llamar a la función agregarObservacion para crear el recuadro ajustado al texto
    const recuadroAlto = agregarObservacion(pdf, observacionFotografico, marginLeft, yOffset, contentWidth);

    // Ajustar yOffset después de agregar el recuadro
    yOffset += recuadroAlto + 10; // Añadir un espacio después del recuadro

    agregarPagina4();  // Continuar con la siguiente página
}
agregarImagenesRegistroFotografico();
}

function agregarPagina4() {
    // Página 4: Fotografía Termográfica y Registro Fotográfico de Componentes
    addNewPage(pdf); 
    pdf.setFontSize(16);
    pdf.setTextColor(0, 0, 0); // Texto color naranja
    pdf.text("FOTOGRAFÍAS TERMOGRÁFICAS", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 10;

    // Encabezado de la tabla
   

// Obtener los valores del formulario para la tabla termográfica
const termograficaBody = [
    ['Contactor', document.querySelector('input[name="temperatura_contactor"]').value || 'N/A', '75°C'],
    ['Relé de estado sólido', document.querySelector('input[name="temperatura_rele_estado_solido"]').value || 'N/A', '75°C'],
    ['Servo amplificador', document.querySelector('input[name="temperatura_servo_amplificador"]').value || 'N/A', '75°C'],
    ['Safety Relay', document.querySelector('input[name="temperatura_safety_relay_comp"]').value || 'N/A', '75°C'],
    ['VDF', document.querySelector('input[name="temperatura_vdf"]').value || 'N/A', '75°C'],
    ['PLC', document.querySelector('input[name="temperatura_plc"]').value || 'N/A', '75°C'],
    ['Relé 24 VDC', document.querySelector('input[name="temperatura_rele_24vdc"]').value || 'N/A', '75°C'],
    ['Power Supply', document.querySelector('input[name="temperatura_power_supply"]').value || 'N/A', '75°C']
];

// Generar la tabla en el PDF utilizando autoTable
pdf.autoTable({
    head: [['Componente', 'Temperatura (°C)', 'Rango de maximo (°C)']],
    body: termograficaBody,
    startY: yOffset, // Posición vertical de inicio
    margin: { 
        top: 10,      // Margen superior
        bottom: 10,   // Margen inferior
        left: 15,     // Margen izquierdo
        right: 15     // Margen derecho
    },
    styles: { 
        fontSize: 10,               // Tamaño de fuente general
        halign: 'center',           // Alineación del texto en el centro
        textColor: [0, 0, 0],       // Texto negro
        lineColor: [0, 0, 0],       // Borde negro
        lineWidth: 0.5              // Ancho del borde
    },
    headStyles: { 
        fillColor: [0, 155, 0],     // Fondo del encabezado (verde)
        textColor: [255, 255, 255], // Texto del encabezado (blanco)
        fontSize: 12,               // Tamaño de fuente del encabezado
        fontStyle: 'bold'           // Negrita para el encabezado
    },
    bodyStyles: { 
        fillColor: [245, 245, 245], // Fondo del cuerpo (gris claro)
        textColor: [0, 0, 0],       // Texto negro
        lineColor: [0, 0, 0],       // Borde negro
        lineWidth: 0.5              // Ancho del borde
    },
    alternateRowStyles: { 
        fillColor: [220, 220, 220]  // Fondo alternado (gris oscuro)
    },
    theme: 'grid', // Tema de la tabla con bordes visibles
    columnStyles: {
        0: { cellWidth: 60 }, // Ancho para la columna de componentes
        1: { cellWidth: 60 }, // Ancho para la temperatura ingresada
        2: { cellWidth: 60 }  // Ancho para el rango de trabajo máximo
    }
});

// Ajustar yOffset después de la tabla
yOffset = pdf.lastAutoTable.finalY + 10;



    // Si yOffset está cerca del final, agregar una nueva página
    if (yOffset > pdf.internal.pageSize.getHeight() - 100) {
        addNewPage(pdf);
    }

    // Sección de imágenes
    yOffset += 10;
    pdf.setTextColor(0, 0, 0); // Texto naranja
    pdf.text("REGISTRO FOTOGRÁFICO DE COMPONENTES", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 10;

    const componentesImagenes = [
    { id: "imagen_contactor", label: "Contactor" },
    { id: "imagen_rele_estado_solido", label: "Relé de Estado Sólido" },
    { id: "imagen_servo_amplificador", label: "Servo Amplificador" },
    { id: "imagen_safety_relay_comp", label: "Safety Relay" },
    { id: "imagen_vdf", label: "VDF" },
    { id: "imagen_plc", label: "PLC" },
    { id: "imagen_rele_24vdc", label: "Relé 24 VDC" },
    { id: "imagen_power_supply", label: "Power Supply" }
];

let componenteIndex = 0;

function agregarImagenesDeComponentes() {
    const columnas = 4; // 4 imágenes por fila
    const filas = 2; // 2 filas de imágenes
    const espacio = 5; // Espacio entre las imágenes
    const bordeWidth = (pdf.internal.pageSize.getWidth() - 2 * marginLeft - (columnas - 1) * espacio) / columnas; // Ancho del borde
    const bordeHeight = bordeWidth * 0.75; // Mantener proporción 4:3

    function agregarImagen(componente, xPosition, yPosition, width, height, callback) {
        const imagenElement = document.getElementById(componente.id);
        const file = imagenElement.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function() {
                    // Ajustar tamaño de la imagen y centrarla
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    const ratio = Math.min((width * 0.9) / imgWidth, (height * 0.9) / imgHeight); // Reducir tamaño al 90%
                    const newWidth = imgWidth * ratio;
                    const newHeight = imgHeight * ratio;
                    const offsetX = (width - newWidth) / 2;
                    const offsetY = (height - newHeight) / 2;

                    // Insertar imagen
                    pdf.addImage(img, 'JPEG', xPosition + offsetX, yPosition + offsetY, newWidth, newHeight);

                    // Añadir etiqueta debajo de la imagen
                    pdf.setFontSize(10);
                    pdf.setTextColor(0, 0, 0);
                    pdf.text(componente.label, xPosition + width / 2, yPosition + height + 5, { align: 'center' });

                    callback();
                };
            };
            reader.readAsDataURL(file);
        } else {
            callback();
        }
    }

    function agregarImagenes() {
        if (componenteIndex < componentesImagenes.length) {
            let fila = Math.floor(componenteIndex / columnas); // Determinar la fila
            let columna = componenteIndex % columnas; // Determinar la columna

            let xPosition = marginLeft + columna * (bordeWidth + espacio); // Posición horizontal del borde
            let yPosition = yOffset + fila * (bordeHeight + 15 + espacio); // Posición vertical del borde

            // Dibujar borde alrededor de la imagen
            pdf.setDrawColor(0, 155, 0); // Color negro
            pdf.setLineWidth(0.5); // Ancho de línea para el borde
            pdf.rect(xPosition, yPosition, bordeWidth, bordeHeight); // Dibujar el borde

            let componente = componentesImagenes[componenteIndex];

            // Insertar la imagen dentro del cuadro y centrarla
            agregarImagen(componente, xPosition, yPosition, bordeWidth, bordeHeight, function() {
                componenteIndex++;
                if (componenteIndex % columnas === 0 && fila === filas - 1) {
                    yOffset += bordeHeight + 15 + espacio; // Ajustar la posición vertical después de cada fila
                }
                agregarImagenes(); // Llamada recursiva para agregar la siguiente imagen
            });
        } else {
            // Continuar con el resto del PDF cuando se han insertado todas las imágenes
            yOffset += bordeHeight + 5 + espacio; // Ajustar después de agregar la última fila de imágenes
            agregarObservacionComponentes(); // Pasar a la siguiente sección
        }
    }

    agregarImagenes(); // Iniciar la inserción de imágenes
}

function agregarObservacionComponentes() {
    pdf.setFontSize(12);
    yOffset += 8; // Reducir el espacio entre imágenes y observación

    pdf.text("Observación Final", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 5;

    // Obtener el texto de observación del campo correspondiente
    let observacionComponentes = document.getElementById("observacion_componentes").value;

    // Llamar a la función agregarObservacion para crear el recuadro ajustado al texto
    const recuadroAlto = agregarObservacion(pdf, observacionComponentes, marginLeft, yOffset, contentWidth, [57, 255, 20], null); // Puedes agregar un color de fondo si lo deseas

    // Ajustar yOffset después de agregar el recuadro
    yOffset += recuadroAlto + 10; // Añadir un espacio después del recuadro

    agregarPagina5();  // Continuar con la siguiente página
}
agregarImagenesDeComponentes();
}


            function agregarPagina5() {
                addNewPage(pdf);
                 pdf.setFontSize(14);
    pdf.text("Reporte Diagnóstico", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 10;

    const diagnosticoHead = [['Componente', 'Detalle Diagnóstico', 'Acción Correctiva', 'Observación']];
    const diagnosticoBody = [
        [
            'Actuador de sello',
            document.querySelector('select[name="detalle_diagnostico_actuador"]').value,
            document.querySelector('select[name="accion_correctiva_actuador"]').value,
            document.querySelector('select[name="observacion_actuador"]').value
        ],
        [
            'Cintas de entrada',
            document.querySelector('select[name="detalle_diagnostico_cintas_entrada"]').value,
            document.querySelector('select[name="accion_correctiva_cintas_entrada"]').value,
            document.querySelector('select[name="observacion_cintas_entrada"]').value
        ],
        [
            'Cintas de salida',
            document.querySelector('select[name="detalle_diagnostico_cintas_salida"]').value,
            document.querySelector('select[name="accion_correctiva_cintas_salida"]').value,
            document.querySelector('select[name="observacion_cintas_salida"]').value
        ],
        [
            'Tablero',
            document.querySelector('select[name="detalle_diagnostico_tablero"]').value,
            document.querySelector('select[name="accion_correctiva_tablero"]').value,
            document.querySelector('select[name="observacion_tablero"]').value
        ],
        [
            'Matriz',
            document.querySelector('select[name="detalle_diagnostico_tablero"]').value,
            document.querySelector('select[name="accion_correctiva_tablero"]').value,
            document.querySelector('select[name="observacion_tablero"]').value
        ],
        [
            'Pantalla HMI',
            document.querySelector('select[name="detalle_diagnostico_tablero"]').value,
            document.querySelector('select[name="accion_correctiva_tablero"]').value,
            document.querySelector('select[name="observacion_tablero"]').value
        ],
        [
            'Alimentacion de film',
            document.querySelector('select[name="detalle_diagnostico_tablero"]').value,
            document.querySelector('select[name="accion_correctiva_tablero"]').value,
            document.querySelector('select[name="observacion_tablero"]').value
        ],
        [
            'Estacion de sello',
            document.querySelector('select[name="detalle_diagnostico_tablero"]').value,
            document.querySelector('select[name="accion_correctiva_tablero"]').value,
            document.querySelector('select[name="observacion_tablero"]').value
        ],

    ];

    // Cambiar los colores de la tabla
    pdf.autoTable({
    head: diagnosticoHead,
    body: diagnosticoBody,
    startY: yOffset, // Posición vertical de inicio
    margin: { 
        top: 10,      // Margen superior
        bottom: 10,   // Margen inferior
        left: 10,     // Margen izquierdo
        right: 10     // Margen derecho
    },
    styles: { 
        fontSize: 10,               // Tamaño de fuente general
        halign: 'center',           // Alineación del texto en el centro
       
    },
    headStyles: { 
        fillColor: [0, 255, 0], // Fondo del encabezado (blanco)
        textColor: [255, 255, 255],       // Texto del encabezado (negro)

    },
   
    theme: 'striped' // Tema de la tabla (con filas alternadas)
});


                yOffset = pdf.lastAutoTable.finalY + 10;

                if (yOffset > pdf.internal.pageSize.getHeight() - 60) {
                    addNewPage(pdf);
                }

                pdf.setFontSize(12);
    yOffset += 8; // Reducir el espacio entre imágenes y observación

    pdf.text("Observación Final", pdf.internal.pageSize.getWidth() / 2, yOffset, { align: 'center' });
    yOffset += 5;

    // Obtener el texto de observación del campo correspondiente
    let observacionComponentes = document.getElementById("observacion_componentes").value;

    // Llamar a la función agregarObservacion para crear el recuadro ajustado al texto
    const recuadroAlto = agregarObservacion(pdf, observacionComponentes, marginLeft, yOffset, contentWidth, [57, 255, 20], null); // Puedes agregar un color de fondo si lo deseas

    // Ajustar yOffset después de agregar el recuadro
    yOffset += recuadroAlto + 10; // Añadir un espacio después del recuadro
                pdf.save("formulario_servicio.pdf");
            }

            agregarPagina1();
        });

        function addImageToPDF(pdf, inputFileElement, x, y, width, height, callback) {
            const file = inputFileElement.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = function() {
                        let imgWidth = img.width;
                        let imgHeight = img.height;
                        let ratio = Math.min(width / imgWidth, height / imgHeight);
                        let newWidth = imgWidth * ratio;
                        let newHeight = imgHeight * ratio;
                        pdf.addImage(img, x, y, newWidth, newHeight);
                        callback();
                    }
                }
                reader.readAsDataURL(file);
            } else {
                callback();
            }
        }
    </script>
</body>
</html>
